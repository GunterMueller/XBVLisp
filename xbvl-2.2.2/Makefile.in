# Makefile.in --- Xbvlisp
# Copyright (C) 1997
#   Damien Ploix <damien@ai.univ-paris8.fr>
#
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Library General Public
# License as published by the Free Software Foundation; either
# version 2 of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Library General Public License for more details.
#
# You should have received a copy of the GNU Library General Public
# License along with this library; if not, write to the Free Software
# Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
#
########################################################################

CFLAGS = -w @CFLAGS@
LDFLAGS =

########################################################################

SHELL = /bin/sh
INSTALL = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@

srcdir = @srcdir@
top_srcdir = @top_srcdir@
VPATH = @srcdir@
localdir = @prefix@
LISPLIBDIR = $(localdir)/lib/xbvlisp
FONTLIB = $(localdir)/lib/xbvlisp/fonts
BITMAPLIB = $(localdir)/lib/xbvlisp/bitmap

HAVE_OPENGL = @OPEN_GL@
OPEN_GL_SUBDIR = src_open_gl 
HERSHEY_SUBDIR = src_hershey 
X_SUBDIR = src_x
SRC_SUBDIR = src_data src_lisp 
SUBDIRS = $(OPEN_GL_SUBDIR) $(X_SUBDIR) $(SRC_SUBDIR)

all: $(LISPLIBDIR) include/vlisp_files.h
	if test -n "$(HAVE_OPENGL)" ; then \
	  for d in $(OPEN_GL_SUBDIR); do (cd $$d && $(MAKE) $@) || break; done\
	fi;\
	for d in $(X_SUBDIR) $(SRC_SUBDIR); do (cd $$d && $(MAKE) $@); done

mesa: 
	(cd src_mesa && make mesa) 

install:
	$(INSTALL_DATA) XbVLISP /usr/lib/X11/app-defaults	
	for d in $(SRC_SUBDIR); do	(cd $$d && $(MAKE) $@) || break; done
	if test -n "$(HAVE_OPENGL)" ; then (cd $(HERSHEY_SUBDIR) && $(MAKE) $@); fi;

$(LISPLIBDIR):
	if test ! -d $(LISPLIBDIR) ; then mkdir $(LISPLIBDIR) $(FONTLIB) $(BITMAPLIB); fi;

include/vlisp_files.h:
	echo "/* FICHIER GENERE PAR MAKEFILE : NE PAS MODIFIER */" > include/vlisp_files.h
	echo "/* FILE GENERATED BY MAKEFILE : DO NOT MODIFY */" >> include/vlisp_files.h
	echo "#define VLISPDIR  \""$(LISPLIBDIR)"/\"" >> include/vlisp_files.h 
	echo "#define DFILE     \""$(LISPLIBDIR)"/aidvlisp.:dat\"" >> include/vlisp_files.h 
	echo "#define SFILE     \""$(LISPLIBDIR)"/aidvlisp.:sec\"" >> include/vlisp_files.h 
	echo "#define INFILE    \""$(LISPLIBDIR)"/aidvlisp.dat\"" >> include/vlisp_files.h 
	echo "#define BVLISPSYS \""$(LISPLIBDIR)"/bvlisp.sys\"" >> include/vlisp_files.h

# Standard GNU clean* targets:
distclean: 
	rm -f src_lisp/xbvl 
	rm -f src_data/aide src_data/traaide 
	rm -f src_data/*dat src_data/*sec
	find . -name '*~'  -exec rm {} \;
	find . -name '.*~'  -exec rm {} \;
	find . -name '.*~'  -exec rm {} \;
	find . -name '*.o' -exec rm {} \;
	find . -name '*.a' -exec rm {} \;
	find . -name Makefile -exec rm {} \;
	rm -f Makefile config.cache config.status

clean:
	for d in $(SUBDIRS); do	(cd $$d && $(MAKE) $@); done
	rm -f .*~ *~ config.log include/vlisp_files.h

realclean: clean

# GNU autoconf(1) targets:
Makefile: Makefile.in config.status
	$(SHELL) config.status
config.status: configure
	$(SHELL) config.status --recheck
configure: configure.in
	cd $(srcdir); autoconf

########################################################################
# Distributions
########################################################################

DISTFILES.top = Makefile.in configure configure.in config.guess config.sub \
		install-sh XbVLISP

DISTFILES.src = Makefile.in  \
		BrTree.c Convert.c Drawxbvl.c MoveTort.c ObjAtome.c ObjInit.c \
		Tortue.c XbvlActn.c XbvlVideo.c Xbvlisp.c XtToLISP.c aide.c \
		car.c check.c contro.c crewin.c cursor.c err.c \
		eval.c fdate.c fdisp.c fil.c flo.c gc.c \
		getchar.c hash.c in.c ind.c indinit.c init.c \
		list.c main.c menu.c misc.c mod.c num.c \
		out.c prolog.c sofons.c spec.c str.c strings.c \
		xActions.c xBitmap.c xCalbks.c xCrObjet.c xDraw.c xEvent.c \
		xGC.c xGetRes.c xTranslation.c xWdgFncs.c xaide.c xcrewin.c \
		xgetargs.c xgetch.c xgetvals.c xinit.c xkill.c xmenu.c \
		xpointer.c xsetvals.c xsrc.c xvter.c xwst.c 

DISTFILES.inc = BrTree.h BrTreeP.h DrawXbvlP.h Drawxbvl.h DrawxbvlP.h \
		Objets.h R3toR4.h Tortue.h TortueP.h Xbvlisp.h XbvlispP.h \
		actions.h aide.h assert.h cr_ex.h curses.h fons.h \
		genDecl.h proto.h vcurses.h vlisp.h vlisp_files.h xwin.h \

